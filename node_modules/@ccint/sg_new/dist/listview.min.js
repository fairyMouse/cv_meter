!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("@ccint/sg_new"),require("jquery"));else if("function"==typeof define&&define.amd)define(["@ccint/sg_new","jquery"],t);else{var r="object"==typeof exports?t(require("@ccint/sg_new"),require("jquery")):t(e.sg,e.$);for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(this,function(e,t){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=31)}({0:function(t,r){t.exports=e},1:function(e,r){e.exports=t},31:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(r(1)),a=n(r(0));a.default.Component.define("ListView",{properties:{item_vm:"",list_data:[],url:"",method:"GET",start:0,limit:10,params:{},format:{start:"start",limit:"len"},onError:null,onAjaxError:null,empty:null,itemBeforeRender:function(e){},itemAfterRender:function(e){},done:function(){}},template:'{{each data item}}<div class="sg_listview"><div sg-view="{{vm_name}}"><param id="item" type="json" value="{{item.replace(/&quot;/ig, \'\')}}"></div></div>{{/each}}',onBeforeRender:function(e){var t=this;if(!t.item_vm){var r="lack of sub view model";return a.default.fire("list_view_error",r),void(t.onError&&t.onError(r))}if(t.url){t.offset=t.start,t._request(t.limit,function(r,n){e({data:r,vm_name:t.item_vm,is_end:n})});var n=0;a.default.un(t.item_vm+"_afterrender"),a.default.on(t.item_vm+"_afterrender",function(e){n++,t.limit-t.is_end===n&&(t.done(e.$dom,t.originData,t.is_end),a.default.un(t.item_vm+"_afterrender"))})}else{if(!o.default.isArray(t.data)){var i="invalid data format";return a.default.fire("listview_error",i),void(t.onAjaxError&&t.onAjaxError(i))}e({data:t.data,vm_name:t.item_vm})}},onRender:function(e){var t=this,r=t.$parent;!e.data||e.data.length?(t.is_end=e.is_end,a.default.View.remove(t.item_vm),a.default.View.define(t.item_vm,{onBeforeRender:function(e,r){t.itemBeforeRender(r),e(r.item)},onRender:function(){t.itemAfterRender(this.$parent),a.default.fire(t.item_vm+"_afterrender",{$dom:r})}})):t.empty(r)},getOffset:function(){return this.offset||0},getTotal:function(){return this.total||0},append:function(e,t){var r=this;t&&(r.offset=t),r._request(r.limit,function(e,t){o.default.each(e,function(e,n){var i=(0,o.default)('<div class="sg_listview"></div>');a.default.View.require(r.item_vm).render(i,{item:JSON.parse(n),is_end:t}),r.$parent.append(i)}),r.done(r.$parent,r.originData,t)},function(t){"function"==typeof e&&e(t)})},_request:function(e,t,r){var n=this,i=n.format.start,f=n.format.limit,u=n.params;u[i]=n.offset,u[f]=e,a.default.Model.get(n.url,!1,"POST"===n.method).getData(u,function(e){if(e.errno)return a.default.fire("listview_ajax_error",e),n.onAjaxError&&n.onAjaxError(e),void(r&&r(e));n.originData=e.data,n.total=n.originData.total,e=n._findResponseArray(e),e=o.default.map(e,function(e){return JSON.stringify(e)}),n.offset+=e.length,n.total||(n.total=n.offset),t&&t(e,u[f]-e.length)},function(e){a.default.fire("listview_ajax_error",e),n.onAjaxError&&n.onAjaxError(e),r&&r(e)})},_findResponseArray:function(e){var t=this,r=!1;if(o.default.isArray(e))r=e;else for(var n in e)if("object"===i(e[n])&&(r=t._findResponseArray(e[n])),r)break;return r||[]}})}}).default});