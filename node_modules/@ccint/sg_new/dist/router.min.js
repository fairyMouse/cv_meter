!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("@ccint/sg_new"),require("jquery"));else if("function"==typeof define&&define.amd)define(["@ccint/sg_new","jquery"],e);else{var o="object"==typeof exports?e(require("@ccint/sg_new"),require("jquery")):e(t.sg,t.$);for(var r in o)("object"==typeof exports?exports:t)[r]=o[r]}}(this,function(t,e){return function(t){function e(r){if(o[r])return o[r].exports;var n=o[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var o={};return e.m=t,e.c=o,e.d=function(t,o,r){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=19)}({0:function(e,o){e.exports=t},1:function(t,o){t.exports=e},19:function(t,e,o){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function n(){function t(){f.default.fire("loadingStop",{$dom:n.$dom});var t=d.current.scrollTop||f.default.config.defaultScrollTop;(0,c.default)(window).scrollTop(t),f.default.utils.log("window : "+t,"ScrollRestore"),n.loaded=1}function e(){var e=void 0,o=void 0;if(f.default.utils.setTitle(n.title),n.$dom.appendTo(r).show().siblings(".sg_layout").detach(),l){if(l.vm&&(f.default.utils.log(l.vm.constructor.name,"ViewLeave"),l.vm.onLeave&&l.vm.onLeave(),!1===l.vm.needCache&&(l.vm.destroy(),l.vm=null,l.loaded=0)),e=n.scrollTop||f.default.config.defaultScrollTop,(0,c.default)(window).scrollTop(e),f.default.utils.log("window : "+e,"ScrollRestore"),!1!==n.vm.needCache&&n.loaded)return n.$dom.hasClass(".sg_scroll_x")?(o=n.$dom.data("scrollLeft")||0,n.$dom.scrollLeft(o),f.default.utils.log("sg_layout : "+o,"ScrollRestore")):n.$dom.hasClass(".sg_scroll_y")&&(e=n.$dom.data("scrollTop")||0,n.$dom.scrollTop(e),f.default.utils.log("sg_layout : "+e,"ScrollRestore")),n.$dom.find(".sg_scroll_x").each(function(){var t=(0,c.default)(this),e=t.data("scrollLeft")||0;t.scrollLeft(e),f.default.utils.log("sg_scroll_x : "+e,"ScrollRestore")}),n.$dom.find(".sg_scroll_y").each(function(){var t=(0,c.default)(this),e=t.data("scrollTop")||0;t.scrollTop(e),f.default.utils.log("sg_scroll_y : "+e,"ScrollRestore")}),f.default.utils.log(n.vm.constructor.name,"ViewRestart"),void(n.vm.onRestart&&n.vm.onRestart());f.default.utils.log("end","ViewSwitch")}f.default.fire("loadingStart",{$dom:n.$dom}),n.vm.render(n.$dom,n.params,t)}function o(){n.vm?e():(f.default.fire("loadingStart",{$dom:r}),f.default.View.require(n.vmName,function(t){d.current.url===n.url&&(f.default.fire("loadingStop",{$dom:r}),n.vm=t,e())}))}if(!1!==d.update())if(!f.default.config.fixDirection||d.current&&d.current.tm){f.default.fire("routeChange");var r=f.default.config.parent,n=d.current,l=d.last;if(l){if(n.pathName===l.pathName&&l.vm&&l.vm.onRouteChange)return n.vm=l.vm,n.$dom=l.$dom,n.loaded=l.loaded=1,void l.vm.onRouteChange(l,n);l.scrollTop=(0,c.default)(window).scrollTop(),f.default.utils.log("window : "+l.scrollTop,"ScrollSave"),l.$dom.find(".sg_scroll_x").each(function(){var t=(0,c.default)(this),e=t.scrollLeft();t.data("scrollLeft",e),f.default.utils.log("sg_scroll_x : "+e,"ScrollSave")}),l.$dom.find(".sg_scroll_y").each(function(){var t=(0,c.default)(this),e=t.scrollTop();t.data("scrollTop",e),f.default.utils.log("sg_scroll_y : "+e,"ScrollSave")}),o()}else i(n.filters,n.pathName,n.params,!0,o)}else d.fixTm()}function i(t,e,o,r,n){function i(a){a!==l?g[t[a]]?g[t[a]].call(window,e,o,r,function(){i(a+1)}):i(a+1):n&&n.call(window)}if(!t)return n&&n.call(window),!0;var l=t.length;i(0)}function l(){if(!d){h=f.default.config.html4Mode?"hash":history.pushState?"history":"hash";var t=(d="history"===h?new u:new s).getPathName().split("/");if(t.length>1){var e={};for(var o in f.default.config.routes)e[o]=f.default.config.routes[o],o?"/"!==o[0]&&(t[t.length-1]=o,e[t.join("/")]=f.default.config.routes[o]):(t[t.length-1]="",e[t.join("/")]=f.default.config.routes[o],t[t.length-1]="index.html",e[t.join("/")]=f.default.config.routes[o],t[t.length-1]="index.php",e[t.join("/")]=f.default.config.routes[o]);f.default.config.routes=e}}return d}function a(){this.history=new f.default.Cache(20),this.last=null,this.current=null}function u(){a.call(this)}function s(){a.call(this)}var c=r(o(1)),f=r(o(0)),d=void 0,h=void 0,g={};a.prototype={start:function(){history.scrollRestoration&&(history.scrollRestoration="manual"),f.default.Component.on("ComponentCreate",function(t){f.default.router.current&&(t.instance.id||f.default.router.current.componentInstances.push(t.instance))}),this._start()},update:function(){var t=this.getParams(),e=t.tm||0;if(delete t.tm,!f.default.config.fixDirection||e){var o=location.href;if(this.current&&this.current.url===o)return!1;var r=this.history.get(o);if(r)return this.last=this.current,void(this.current=r);this.last=this.current;var n=(0,c.default)('<div class="sg_layout"></div>');this.current={tm:e,params:t,url:o,queryString:this.getQueryString(),requestUri:this.getRequestUri(),pathName:this.getPathName(),$dom:n,componentInstances:[]};var i=f.default.config.routes[this.current.pathName],l=f.default.config.resource[i],a=l&&l.title||f.default.config.title,u=l&&l.filters||f.default.config.filters,s=l&&l.animation;this.current.vmName=i,this.current.title=a,this.current.filters=u,this.current.animation=s,this.history.set(o,this.current)}},getParams:function(){for(var t=this.getQueryString().split("&"),e={},o=0,r=t.length;o<r;o++){var n=t[o].split("=");n[0]&&(e[n[0]]=decodeURIComponent(n[1]))}return e},getParam:function(t){return this.getParams()[t]||""},getMode:function(){return h},getCleanUrl:function(){return this.removeParam("tm")},getCurrentHistory:function(){return this.current},getLastHistory:function(){return this.last}},u.prototype={_start:function(){(0,c.default)(window).bind("popstate",n),setTimeout(function(){n()},0)},getQueryString:function(){return location.search.replace("?","")},getRequestUri:function(){return location.pathname+location.search},getPathName:function(){return location.pathname},removeParam:function(t){var e=new RegExp("&?"+t+"=[^&]*"),o=location.href.replace(e,"");return o=f.default.utils.trim(o.replace("?&","?"),"?")},redirect:function(t,e,o){var r=t.replace(/\?.*/gi,""),l=f.default.config.routes[r],a=f.default.config.resource[l],u=a&&a.filters,s=f.default.utils.getUrlParams(t);e=e||{},c.default.extend(s,e),i(u,r,s,o,function(){f.default.config.fixDirection&&(s.tm=+new Date);var e=c.default.param(s);e&&(e=e.replace(/\+/gi,"%20")),e&&(t=r+"?"+e),o?history.replaceState(null,"",t):history.pushState(null,"",t),n()})},fixTm:function(){var t=location.href;/\?/.test(t)?t+="&tm="+(new Date).getTime():t+="?tm="+(new Date).getTime(),history.replaceState(null,"",t),n()}},s.prototype={_start:function(){(0,c.default)(window).bind("hashchange",n),setTimeout(function(){n()},0)},getQueryString:function(){return location.hash.replace(/#[^?]*\??/,"")},getRequestUri:function(){return location.hash.replace(/#!?/,"")},getPathName:function(){return this.getRequestUri().replace(/\?.*/,"")},removeParam:function(t){var e=new RegExp("&?"+t+"=[^&]*"),o=location.hash.replace(e,"");return o=f.default.utils.trim(o.replace("?&","?"),"?"),location.protocol+"//"+location.host+location.pathname+location.search+o},redirect:function(t,e,o){var r=t.replace(/\?.*/gi,""),n=f.default.config.routes[r],l=f.default.config.resource[n],a=l&&l.filters,u=f.default.utils.getUrlParams(t);e=e||{},c.default.extend(u,e),i(a,r,u,o,function(){f.default.config.fixDirection&&(u.tm=+new Date);var e=c.default.param(u);e&&(e=e.replace(/\+/gi,"%20")),e&&(t=r+"?"+e),t&&(t="#!"+t),o?location.replace(t):location.href=t})},fixTm:function(){var t=location.hash;t?/\?/.test(t)?t+="&tm="+(new Date).getTime():t+="?tm="+(new Date).getTime():t="#!?tm="+(new Date).getTime(),location.replace(t)}},f.default.utils.inherits(u,a),f.default.utils.inherits(s,a),f.default.Action.set({"sg-redirect":{init:function(t){t.on("click",function(){var e=t.attr("sg-redirect"),o=t.attr("sg-stop-propagation");if("-1"===e?history.go(-1):/^https?:\/\//gi.test(e)?location.href=e:f.default.router.redirect(e),1===o)return!1})}}}),f.default.Router={HistoryRouter:u,HashRouter:s,init:function(){f.default.router=l()},addFilter:function(t,e){"string"===c.default.type(t)?g[t]=e:"object"===c.default.type(t)&&c.default.extend(g,t)},deps:["View","Event"]}}}).default});