import sg from '../sg.js'
import './toast.css'

sg.Component.define('Toast', {
  properties: {
    text: '', // 提示文字
    type: 0, // 0表示处理失败的样式，1表示成功, 2表示警告样式
    onShow: null, // 展示回调
    onHide: null, // 隐藏回调
    showAnimation: 'fadeInUp', // 展现动画
    hideAnimation: 'fadeOutUp' // 隐藏动画
  },
  template: '<div class="sg_toast {{status[type]}}">{{if type == 1}}<i class="icon_success sg_toast_icon"></i> {{else}}<i class="icon_alert sg_toast_icon"></i>{{/if}}{{text}}</div>',
  onBeforeRender: function (next) {
    let self = this
    let status = ['failed', 'success', 'alter']
    next({
      type: self.type,
      text: self.text,
      status: status
    }, 1)
  },
  onRender: function () {
    let self = this
    let $dom = self.$dom
    $dom.css({
      'margin-left': -$dom.outerWidth() / 2,
      'margin-top': -$dom.outerHeight() / 2
    })
    sg.utils.reflow()
    if (self.showAnimation) {
      $dom.animateCss(self.showAnimation, function () {
        setTimeout(function () {
          if (self.hideAnimation) {
            $dom.animateCss(self.hideAnimation, function () {
              self._hide()
            })
          } else {
            self._hide()
          }
        }, 1500)
        self.onShow && self.onShow()
      })
    } else {
      self.onShow && self.onShow()
    }
  },
  _hide: function () {
    let self = this
    let $dom = self.$dom
    $dom.hide()
    self.onHide && self.onHide()
    self.destroy()
  }
})
